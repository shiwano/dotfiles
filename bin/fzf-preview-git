#!/bin/bash

main() {
  set -euo pipefail

  local args="$(echo $@ | cut -c3-)"

  if [ "$(git diff --name-only $args)" ]; then
    git diff --color $args
  elif [ "$(git diff --cached --name-only $args)" ]; then
    git diff --color --cached $args
  elif [ -d $args ]; then
    ls -la $args
  elif file --mime-type $args | grep -qF image/; then
    kitty icat --clear --transfer-mode=memory --stdin=no --place=${FZF_PREVIEW_COLUMNS}x${FZF_PREVIEW_LINES}@0x0 $args
  elif file --dereference --mime $args | grep -qF binary; then
    echo "$(file --dereference --mime -- $args)"
  else
    bat --style=numbers --color=always --pager=never --line-range :500 $args
  fi
}

main "${@}"
